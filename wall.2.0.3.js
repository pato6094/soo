window.paywall={isInitialized:!1,paywallId:null,_initPromise:null,_eventHandlers:new Map,_paywallDocumentRoot:null,_observer:null,_overrideStyles:null,_iframeCreated:!1,init:function(e,a,n){return this._initPromise||(this.paywallId=e,this._paywallDocumentRoot=null!=n?n:document,window.addEventListener("message",this._globalEventHandler.bind(this),!1),this._initPromise=new Promise(e=>{this._addEventHandler("init",a=>{"state"===a.data.type&&(this.isInitialized=!0,this._removeEventHandler("init"),e(!0))})})),this._initPromise},_createAndAppendIframe:function(){this._iframeCreated||(this._iframeCreated=!0,window.requestAnimationFrame(()=>{let e=()=>{let e=document.createElement("iframe");e.src="".concat("https://onlineapp.pro","/paywall/").concat(this.paywallId,"?v=2.0.3"),e.id="paywall-".concat(this.paywallId),e.style.display="none";let a=this._paywallDocumentRoot.querySelector("body");a?a.appendChild(e):console.error("[PAYWALL ERROR] Paywall container not found")};"loading"===this._paywallDocumentRoot.readyState?this._paywallDocumentRoot.addEventListener("DOMContentLoaded",e):e()}))},_globalEventHandler:function(e){if(!this._iframeCreated)return;let a=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId));if(e.source===(null==a?void 0:a.contentWindow))for(let[,n]of("change-styles"===e.data.type?Object.assign(a.style,{...e.data.style,...this._overrideStyles||{}}):"redirect"===e.data.type?window.open(e.data.redirectUrl):"remove"===e.data.type&&a.remove(),this._eventHandlers))n(e)},_addEventHandler:function(e,a){this._eventHandlers.set(e,a)},_removeEventHandler:function(e){this._eventHandlers.delete(e)},_ensureInitialized:async function(){return this.paywallId||this.init("581"),this.paywallId},_ensureIframeCreated:async function(){await this._ensureInitialized(),this._iframeCreated||(this._createAndAppendIframe(),this.isInitialized||await this._initPromise)},open:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{resolveEvent:"opened",paywallContainerId:void 0};return await this._ensureIframeCreated(),new Promise((a,n)=>{var t;if(this._addEventHandler("open",t=>{var s;if((null===(s=t.data)||void 0===s?void 0:s.type)==="state"&&["".concat("https://onlineapp.pro"),"https://onlineapp.live","https://onlineapp.stream"].includes(t.origin)){if("invisible"===t.data.state.visibility_status&&"paid"!==t.data.state.purchase_status&&"tokenization-sign-in"!==t.data.state.visibility_status_reason)this._removeEventHandler("open"),n(t.data.state);else switch(e.resolveEvent){case"opened":"visible"===t.data.state.visibility_status?(this._removeEventHandler("open"),a(t.data.state)):"invisible"===t.data.state.visibility_status&&(this._removeEventHandler("open"),n(t.data.state));break;case"signed-in":"signed-in"===t.data.state.auth_status&&(this._removeEventHandler("open"),a(t.data.state));break;case"success-purchase":"paid"===t.data.state.purchase_status&&(this._removeEventHandler("open"),a(t.data.state))}}}),null==e?void 0:e.paywallContainerId){let a=this._paywallDocumentRoot.getElementById(e.paywallContainerId);a?this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId))?(this._updateIframeStyles(a),new ResizeObserver(()=>{this._updateIframeStyles(a)}).observe(a)):console.warn("[PAYWALL ERROR] Paywall iframe not found"):console.warn("[PAYWALL ERROR] Specified container not found")}null===(t=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId)))||void 0===t||t.contentWindow.postMessage({action:"open"},"*")})},_updateIframeStyles:function(e){let a=e.getBoundingClientRect(),n=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId));this._overrideStyles={position:"absolute",top:"".concat(a.top+window.scrollY,"px"),left:"".concat(a.left+window.scrollX,"px"),width:"".concat(a.width,"px"),height:"".concat(a.height,"px")},n?(n.style.position="absolute",n.style.top="".concat(a.top+window.scrollY,"px"),n.style.left="".concat(a.left+window.scrollX,"px"),n.style.width="".concat(a.width,"px"),n.style.height="".concat(a.height,"px")):console.warn("[PAYWALL ERROR] Paywall iframe not found")},renew:async function(){return await this._ensureIframeCreated(),new Promise((e,a)=>{var n;this._addEventHandler("renew",n=>{var t;(null===(t=n.data)||void 0===t?void 0:t.type)==="state"&&["".concat("https://onlineapp.pro"),"https://onlineapp.live","https://onlineapp.stream"].includes(n.origin)&&("paid"===n.data.state.purchase_status?(this._removeEventHandler("renew"),e(n.data.state)):"closed-by-user"===n.data.state.visibility_status_reason&&(this._removeEventHandler("renew"),a(n.data.state)))}),null===(n=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId)))||void 0===n||n.contentWindow.postMessage({action:"renew"},"*")})},getUser:async function(){return await this._ensureIframeCreated(),this.makeRequest("".concat("https://onlineapp.pro","/api/v1/paywall/").concat(this.paywallId,"/user"))},signOut:async function(){return await this._ensureIframeCreated(),this.makeRequest("".concat("https://onlineapp.pro","/api/signout"),{method:"POST"})},destroy:async function(){await this._ensureIframeCreated();let e=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId));null==e||e.remove()},setUserMetadata:async function(e){await this._ensureIframeCreated();let a=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId));null==a||a.contentWindow.postMessage({type:"SET_USER_METADATA",metadata:e},"*")},getTrialInfo:async function(){return await this._ensureIframeCreated(),new Promise((e,a)=>{let n=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId)),t=Date.now();this._addEventHandler("request_".concat(t),n=>{n.data.requestId===t&&(this._removeEventHandler("request_".concat(t)),n.data.error?a(n.data.error):e(n.data.response))}),null==n||n.contentWindow.postMessage({type:"GET_TRIAL_INFO",requestId:t},"*")})},makeRequest:async function(e,a,n){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return await this._ensureIframeCreated(),new Promise((s,r)=>{let i=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId)),l=Date.now();this._addEventHandler("request_".concat(l),e=>{e.data.requestId===l&&(this._removeEventHandler("request_".concat(l)),e.data.error?r(e.data.error):s(e.data.response))}),null==i||i.contentWindow.postMessage({type:"MAKE_REQUEST",url:e,options:a,requestId:l,useFormData:t},"*"),n&&(n.abort=()=>{this._abortRequest(l)})})},makeStreamRequest:async function*(e,a,n){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];await this._ensureIframeCreated();let s=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId)),r=Date.now();this._addEventHandler("stream_".concat(r),e=>new Promise((a,n)=>{if(e.data.requestId===r){var t,s;(null===(s=e.data)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.error)?n(e.data.data.error):a({chunk:e.data.chunk,done:e.data.done})}else a(null)})),null==s||s.contentWindow.postMessage({type:"MAKE_STREAM_REQUEST",url:e,options:a,requestId:r,useFormData:t},"*"),n&&(n.abort=()=>{this._abortRequest(r)});try{for(;;){let e=await new Promise((e,a)=>{let n=n=>{if(n.data.requestId===r){var t,s;(null===(s=n.data)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.error)?a(n.data.data.error):e(n.data)}};this._addEventHandler("stream_message_".concat(r),n)});if(e.done)break;e.chunk&&(yield e.chunk)}}finally{this._removeEventHandler("stream_".concat(r)),this._removeEventHandler("stream_message_".concat(r))}},_abortRequest:function(e){var a;let n=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId));null==n||null===(a=n.contentWindow)||void 0===a||a.postMessage({type:"ABORT_REQUEST",requestId:e},"*")}}